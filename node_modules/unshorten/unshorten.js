(function() {

	var urlLibrary = require('url'),
	    http = require('http'),
	    https = require('https');

	function unshorten(original_url, callback) {
		url = urlLibrary.parse(original_url);
		('https' == url.protocol ? https : http).request(
			{
				'method': 'HEAD',
				'host': url.host,
				'path': url.pathname
			},
			function(response) {
				if (~[301, 302].indexOf(response.statusCode)) {
					var new_url = response.headers.location;
					if (new_url.substr(0, 4) == "http") {
						callback(new_url);
					} else {
						callback(original_url);
					}
					return;
				} else {
					callback(original_url);
				}
			}
		).end();
	}
	
	module.exports = unshorten;
	
}());